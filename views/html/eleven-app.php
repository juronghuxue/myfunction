<?php
/**
 * Created by PhpStorm.
 * User: LIU
 * Date: 2017/10/25
 * Time: 9:20
 */
?>
<link rel="stylesheet" href="/theme/new/css/dubble-elevenapp.css">
<style type="text/css">
	body{font-size:16px;}
</style>
<div class="eleven-app-wrap">
	<div class="eleven-app" style="position:relative;">
		<img class="bg_01" src="/theme/new/images/dobbleElevenapp/bg_01.png"/>
		<div class="nav">
			<ul>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<li><a href="javascript:;"><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li>
				<!-- <li><a href=""><img src="/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png" /></a></li> -->
			</ul>
			<div class="coupon">
				<span class="coupon-1">gvdtfhdf</span>
				<span class="get-coupon"></span>
			</div>
		</div>
	</div>

	<div class="clearfix coupon-product-wrap">
		<div class="clearfix coupon-product">
			<div class="clearfix coupon-pro">
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
			</div>
		</div>
	</div>

	<!-- crazy-sale -->
	<div>
		<img src="/theme/new/images/dobbleElevenapp/bg_03.jpg" />
		<p></p>
	</div>
	<div class="clearfix crazy-sale-wrap">
		<div class="clearfix crazy-sale">
			<div class="clearfix crazy">
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
				<ul>
					<li class="img"><img src="/theme/new/images/noimg_quesheng.png" /></li>
					<li class="title">Joyetech Metroplis tank aaa xxxxx aaaaa</li>
					<li class="price">
						<span class="new-price">$18.85</span>
						<span class="old-price">$18.85</span>
						<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span>
					</li>
				</ul>
			</div>
		</div>
	</div>


	<!-- giveaway -->

	<div class="clearfix give-away">
		<div><img src="/theme/new/images/dobbleElevenapp/bg_05.jpg" /></div>
		<div class="clearfix left">
			<div class="bg">
				<div class="left-border"></div>
				<div class="left-content">
					<div class="title-wrap">
						<h3>PRIZES</h3>
						<p class="yanse">
							<span></span>
							<span></span>
							<span></span>
						</p>
						
					</div>
					<div class="clearfix zengpin-wrap">
						<div class="zengfirst-wrap">
							<img src="/theme/new/images/noimg_quesheng.png" alt="">
							<div class="zengright">
								<h3>VGOD ELITE MECH MOD</h3>
								<h2>X2</h2>
								<p class="get-now"><span>GET NOW</span><img src="/theme/new/images/dobbleEleven/icon_jiantou_get_now.png" /></p>
							</div>
						</div>
						<div class="zengfirst-wrap">
							<img src="/theme/new/images/noimg_quesheng.png" alt="">
							<div class="zengright">
								<h3>VGOD ELITE MECH MOD</h3>
								<h2>X2</h2>
								<p class="get-now"><span>GET NOW</span><img src="/theme/new/images/dobbleEleven/icon_jiantou_get_now.png" /></p>
							</div>
						</div>
					</div>
					<div class="notes">
						<div class="title"><span>NOTES</span></div>
						<p>1. VGOD Elite RDTA*2 and Tigertek Morphe RDA*2 for you.2. 1st 2 winners get VGOD Elite RDTA, 2nd 2 winners get Tigertek Morphe RDA.</p>
					</div>
					<!-- <span class="tri"></span> -->
				</div>
			</div>
		</div>

		<div class="dianzan">
			<div class="right-border"></div>
			<div class="right-content">
				<!-- <a class="e-widget no-button" href="https://gleam.io/K3lbH/1111-special-party" rel="nofollow">11.11 Special Party</a> -->
		<!-- <script type="text/javascript" src="https://js.gleam.io/e.js" async="true"></script> -->
			</div>
		</div>
	</div>

	<!-- 弹窗 -->
	<!-- <div class="tanchuang-bg">
		<div class="tanchuang">
			<img src="/theme/new/images/dobbleEleven/pic_notice_get_coupon_success.png" />
			<span class="tanchuang-close"><img src="/theme/new/images/dobbleEleven/btn_close.png" /></span>
		</div>
		
	</div> -->
</div>
<!-- 活动结束 -->
<div class="m_activity" style="display:block;z-index: 7777;">

</div>
<div class="l-year-alert-tip-2" style="display:block;height: 200px;z-index: 7778;">
    <div>
        <img src="/theme/new/img/index/tip-header.png" alt="消息头部图片"/>
    </div>
    <div class="l-year-alert-content" style="padding:10px;">
        <h4></h4>
        <p style="text-align: center;">The activity has expired!</p>
    </div>
    
    <div class="l-year-alert-footer" style="background:#fff;">
        <a href="/" style="width: 200px;height: 30px;background:#ee3e43;display: block;color: #fff;line-height: 30px;text-align: center;border-radius: 3px;margin: 0 auto;"> Home Page</a>
    </div>
</div>
<script>
	var data = '<?=$data?>';
	var dataJson = JSON.parse(data);
	// coupon数据
	var brandArr = dataJson.brand;
	console.log(dataJson);
	var imgpathJson = [{
		"brand":"JOYETECH",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_joyetech_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_joyetech.png"
	},{
		"brand":"SMOK",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_smok_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_smok.png"
	},{
		"brand":"ELEAF",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_eleaf_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_eleaf.png"
	},{
		"brand":"WISMEC",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_wismec_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_wismec.png"
	},{
		"brand":"ASPIRE",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_aspire_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_aspire.png"
	},{
		"brand":"VANDYVAPE",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_vandy_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_vandy.png"
	},{
		"brand":"UWELL",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_uwell_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_uwell.png"
	},{
		"brand":"VAPORESSO",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_vapor_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_vapor.png"
	},{
		"brand":"SIGELEI",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_segelei_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_segelei.png"
	},{
		"brand":"IJOY",
		"imgPathactive":"/theme/new/images/dobbleElevenapp/pic_brand_ijoyi_slected.png",
		"imgPath":"/theme/new/images/dobbleElevenapp/pic_brand_ijoy.png"
	}];
	for(var i = 0;i<imgpathJson.length;i++){
		for(var j = 0;j<brandArr.length;j++){
			if(imgpathJson[i].brand == brandArr[j].brand){
				imgpathJson[i].sort = j;
				imgpathJson[i].coupon = brandArr[j].coupon;
				imgpathJson[i].product = brandArr[j].product;
				break;
			}else if(j == brandArr.length-1){
				imgpathJson[i].sort = null;
				imgpathJson[i].coupon = brandArr[j].coupon;
				imgpathJson[i].product = brandArr[j].product;
			}
		}
	}
	// console.log(imgpathJson);
	var arrNew = [];
	for(var i = 0;i<imgpathJson.length;i++){
		for(var j = 0;j<imgpathJson.length;j++){
			if(imgpathJson[j].sort == i){
				arrNew.push(imgpathJson[j]);
				break;
			}
		}
	}
	// console.log(arrNew);
	//imgpathJson  coupon数据已经整理完毕
	function heightLight(num){
		for(var i = 0;i<arrNew.length;i++){
			if(i == num){
				$('.nav ul li').eq(num).find('img').attr('src',arrNew[num].imgPathactive);
			}else{
				$('.nav ul li').eq(i).find('img').attr('src',arrNew[i].imgPath);
			}
		}
		
		coupon_product(num);
	}
	heightLight(0);//初始化高亮
	//coupon和product的渲染
	function coupon_product(num){
		for(var i = 0;i<arrNew.length;i++){
			if(num == i){
				$('.coupon-1').empty().text(arrNew[i].coupon.name).attr({'a':'coupon','cid':arrNew[i].coupon.id});
				var product = arrNew[i].product;
				var str = '';
				product.forEach(function(val,idx){
					var loginStr = '';
					if(val.login == 1){
						loginStr = '<span class="old-price">$'+val.market_price+'</span>';
					}
					str += '<ul data-id="'+val.id+'" data-url="'+val.url+'"><li class="img"><img src="'+val.image+'" onerror="javascript:this.src=\'/theme/new/images/noimg_quesheng.png\';"/></li><li class="title">'+val.name+'</li><li class="price"><span class="new-price">$'+val.price+'</span>'+loginStr+'<span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span></li></ul>';
				});
				$('.coupon-pro').html(str);
			}
		}
	}
	//品牌点击事件
	$('.nav').on('click','li',function(){
		var index = $(this).index();
		heightLight(index);
	});

	var crazyArr = dataJson.crazy;
	var crazyStr = '';
	console.log(crazyArr.length);
	crazyArr.forEach(function(val,idx){
		crazyStr += '<ul data-id="'+val.id+'" data-url="'+val.url+'"><li class="img"><img src="'+val.image+'" onerror="javascript:this.src=\'/theme/new/images/noimg_quesheng.png\';"/></li><li class="title">'+val.name+'</li><li class="price"><span class="new-price">$'+val.price+'</span><span class="old-price">$'+val.market_price+'</span><span class="cart"><img src="/theme/new/images/dobbleElevenapp/icon_shoppingcart.png" /></span></li></ul>';
	});
	$('.crazy-sale .crazy').html(crazyStr);

	var giveawayArr = dataJson.giveaway;
	var giveawayStr = '';
	var giveawayPic = ['/theme/new/images/dobbleEleven/pic_award_1.png','/theme/new/images/dobbleEleven/pic_award_2.png'];
	giveawayArr.forEach(function(val,idx){
		giveawayStr += '<div class="zengfirst-wrap"><img src="'+giveawayPic[idx]+'" alt="" onerror="javascript:this.src=\'/theme/new/images/noimg_quesheng.png\';"><div class="zengright"><h3>'+val.name+'</h3><h2>X'+val.count+'</h2><p data-id="'+val.id+'" data-url="'+val.url+'" class="get-now"><span>GET NOW</span><img src="/theme/new/images/dobbleEleven/icon_jiantou_get_now.png" /></p></div></div>';
	});
	$('.zengpin-wrap').html(giveawayStr);
	var MODRTYPE = isAPP();
	var isLogin = '';//已登陆，未登录，app都通过此变量判断
	function newLogin(x){
		isLogin = x;
	}

	$('.coupon-pro').on('click','ul',function(){
		var product_id = $(this).attr('data-id');
		var url = $(this).attr('data-url');
		var obj = {};
		obj.product_id = product_id;
		obj.url = url;
		console.log(obj);
		tz(obj);
	});

	$('.crazy').on('click','ul',function(){
		var product_id = $(this).attr('data-id');
		var url = $(this).attr('data-url');
		console.log(product_id);
		var obj = {};
		obj.product_id = product_id;
		obj.url = url;
		tz(obj);
	});

	$('.zengpin-wrap').on('click','.get-now',function(){
		var product_id = $(this).attr('data-id');
		var url = $(this).attr('data-url');
		var obj = {};
		obj.product_id = product_id;
		obj.url = url;
		tz(obj);
	});

	function tz(obj){
		if(!GetRequest('tk')){//没有tk参数
			window.open(obj.url,'_blank');
		}else{//app登陆了
			if(MODRTYPE == 'ios'){
				window.webkit.messageHandlers.detail.postMessage('{"product_id":"'+obj.product_id+'"}');
			}else if(MODRTYPE == 'android'){
				window.android.detail('{product_id:'+obj.product_id+'}');
			}
		}
	}
	// else if(GetRequest('tk') == '1'){//app没有登陆
	// 		if(MODRTYPE == 'ios'){
	// 			window.webkit.messageHandlers.login.postMessage(null);
	// 		}else if(MODRTYPE == 'android'){
	// 			window.android.login();
	// 		}
	// 	}

	//领取coupon
	$('.get-coupon').click(function(){
		var cid = $('.coupon-1').attr('cid');
		var a = $('.coupon-1').attr('a');
		var tk = GetRequest('tk');
		var obj = {};
		obj.a = a;
		obj.cid = cid;
		if(tk){//app
			obj.tk = decodeURIComponent(tk);
		}
		$.ajax({
	        url:'/html/activity/eleven.html',
	        type:'GET',
	        data:obj,
	        dataType:'json',
        	beforeSend:function(){
            	layer.load(0, {shade: false});
        	},
        	complete:function(){
            	$('.layui-layer.layui-layer-loading.layer-anim').remove();
        	},
        	success:function(res){
            	$('.ayui-layer-loading.layer-anim').remove();
            	if(res.status == 0){//失败
            		layer.msg(res.msg,{icon:1,time:1000});
            	}else if(res.status == -1){//未登陆
            		if(!GetRequest('tk')){
            			layer.msg(res.msg,{icon:1,time:1000});
            		}else if(GetRequest('tk') == '1'){
            			if(MODRTYPE == 'ios'){
            				window.webkit.messageHandlers.login.postMessage(null);
            			}else if(MODRTYPE == 'android'){
            				window.android.login();
            			}
            		}else{
            			layer.msg(res.msg,{icon:1,time:1000});
            		}
            		
            	}else if(res.status == 1){
            		var scrollTop = $(document).scrollTop();
					var windowHeight = $(window).height();
					var documentHeight = $(document).height();
					var top = scrollTop+windowHeight/2;
					var str = '<div class="tanchuang-bg" style="height:'+documentHeight+'px"><div class="tanchuang" style="top:'+top+'px"><img src="/theme/new/images/dobbleEleven/pic_notice_get_coupon_success.png" /><span class="tanchuang-close" onclick="close_tanchuang(this)"><img src="/theme/new/images/dobbleEleven/btn_close.png" /></span></div></div>';
					$('.eleven-app-wrap').append(str);

            	}
            	
        	},
        	error:function(){
            	$('.layui-layer.layui-layer-loading.layer-anim').remove();
            	layer.msg('error',{icon:0,time:1000});
        	}
    	});
	});


	function close_tanchuang(obj){
		$(obj).closest('.tanchuang').animate({'opacity':'0'},200,function(){
			$(obj).closest('.tanchuang-bg').remove();
		});
	}


	function isAPP(){
        if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {  //判断iPhone|iPad|iPod|iOS
          //alert(navigator.userAgent);  
          return "ios";
        } else if (/(Android)/i.test(navigator.userAgent)) {   //判断Android
            //alert(navigator.userAgent); 
            return "android";
        } else {  //pc
            return "pc";
        };
    }

    function GetRequest(str) {
	   var url = window.location.href; //获取url中"?"符后的字串
	   var obj = {};
	   var arr = [];
	   var _value = null;
	   if(url.indexOf('?') != -1){
	   		arr = url.split('?');
	   		var arrNew = [];
	   		arrNew = arr[1].split('&');
	   		// console.log(arrNew);
	   		for(var i = 0;i<arrNew.length;i++){
	   			var key = arrNew[i].split('=');
	   			// console.log(key);
	   			obj[key[0]] = key[1];
	   		}
	   		for(attr in obj){
	   			if(attr == str){
	   				_value = obj[attr];
	   				break;
	   			}
	   		}
	   }
	   return _value;
	}

</script>
<?php
	$this->registerJs('     
		jQuery(document).ready(function(){
			if(GetRequest("tk")){//yuansheng 
				jQuery("#header").hide();
				jQuery("footer").css({"display":"none"});
				jQuery(".newletter-area").css({"display":"none"});
			}
		});
		if(window.location.href.indexOf("tk") !=-1){
			console.log(1111111111111111111);
			jQuery(".give-away,.dianzan").remove();
			$("#trcking").remove();
		}else{
			jQuery(".right-content").append("<a class=\"e-widget no-button\" href=\"https://gleam.io/K3lbH/1111-special-party\" rel=\"nofollow\">11.11 Special Party</a><script src=\"https://js.gleam.io/e.js\"><\/script>");
		}

	');
?>














